# Exporting order data to GnuCash

The code in this repository can be used to create a CSV file from the data of
a [Bistek](https://www.bistek.com.br) order, so that the accounting software
GnuCash can [import the transactions](https://www.gnucash.org/docs/v4/C/gnucash-help/trans-import.html)
from the file.

## Install the requirements

```bash
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -r requirements.txt
```

## Process

1. Access the confirmation e-mail for your Bistek order
2. Copy the order info by selecting the text inside the white area
3. Paste the data in a file [data/bistek-mail.txt](data/bistek-mail.txt)
4. Execute `python src/main.py data/bistek-mail.txt data/export.csv`
5. Open GnuCash
    - If needed, create a new file `example.gnucash` using the default settings
6. Click on File > Import > Import Transactions from CSV...
7. Select the file `data/export.csv` for import
8. On import preview:
    - Select the option Multi-split
    - Set Leading Lines to Skip to 1 (to ignore the column headers)
    - Set the currency format to "Period: 123,456.78"
    - Use the column dropdown menus to select the columns: Date, Description,
      Transaction Commodity, Memo, Account, Deposit, Price
9. Save the current settings with a good name (to save time on future imports)
10. Go to the next screen, where you can map the account names generated by the
    script to the names used in your GnuCash file. E.g.:
    - Expenses:Groceries: Expenses:SomeKindOfExpense
    - Liabilities:Credit Card: SomePaymentMethod
11. Review the transactions in the next screens, and click on apply
12. That is it! The data should be in the splits of a new transaction in the
    account you've chosen.

## Testing

The `tests` directory contains tests for the functionality which `src/main`
provides. Use the following command to run the tests:

```bash
pytest -vv && flake8 --exclude .git,__pycache__,.venv
```
